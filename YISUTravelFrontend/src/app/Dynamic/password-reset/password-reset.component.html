<div class="password-reset-container">
  <mat-card>
    <mat-card-header>
      <mat-card-title>
        <mat-icon>lock_reset</mat-icon>
        Passwort zurücksetzen
      </mat-card-title>
      <mat-card-subtitle *ngIf="step === 1">Geben Sie Ihre E-Mail-Adresse ein, um einen Reset-Link zu erhalten</mat-card-subtitle>
      <mat-card-subtitle *ngIf="step === 2">Geben Sie Ihr neues Passwort ein</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <mat-progress-spinner *ngIf="loading" diameter="50"></mat-progress-spinner>

      <!-- Step 1: Request Password Reset -->
      <div *ngIf="step === 1 && !loading">
        <form [formGroup]="requestForm" (ngSubmit)="requestPasswordReset()">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>E-Mail-Adresse</mat-label>
            <input matInput type="email" formControlName="email" required>
            <mat-icon matSuffix>email</mat-icon>
            <mat-error *ngIf="requestForm.get('email')?.hasError('required')">
              E-Mail ist erforderlich
            </mat-error>
            <mat-error *ngIf="requestForm.get('email')?.hasError('email')">
              Bitte geben Sie eine gültige E-Mail ein
            </mat-error>
          </mat-form-field>

          <div class="form-actions">
            <button mat-button type="button" (click)="goToLogin()">
              <mat-icon>arrow_back</mat-icon>
              Zurück zum Login
            </button>
            <button mat-raised-button color="primary" type="submit" [disabled]="!requestForm.valid">
              <mat-icon>send</mat-icon>
              Reset-Link senden
            </button>
          </div>
        </form>

        <!-- Success Message -->
        <div class="success-message" *ngIf="emailSent">
          <mat-icon color="primary">check_circle</mat-icon>
          <h3>E-Mail gesendet!</h3>
          <p>Wir haben Ihnen einen Passwort-Reset-Link an Ihre E-Mail-Adresse gesendet.</p>
          <p>Bitte überprüfen Sie Ihr E-Mail-Postfach und folgen Sie den Anweisungen.</p>
          
          <div class="success-actions">
            <button mat-button (click)="resendEmail()">
              <mat-icon>refresh</mat-icon>
              Erneut senden
            </button>
            <button mat-raised-button color="primary" (click)="goToLogin()">
              <mat-icon>login</mat-icon>
              Zum Login
            </button>
          </div>
        </div>
      </div>

      <!-- Step 2: Reset Password -->
      <div *ngIf="step === 2 && !loading">
        <div class="reset-info">
          <mat-icon color="primary">security</mat-icon>
          <h3>Neues Passwort festlegen</h3>
          <p>E-Mail: <strong>{{ email }}</strong></p>
        </div>

        <form [formGroup]="resetForm" (ngSubmit)="resetPassword()">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Neues Passwort</mat-label>
            <input matInput type="password" formControlName="password" required>
            <mat-icon matSuffix>lock</mat-icon>
            <mat-error *ngIf="resetForm.get('password')?.hasError('required')">
              Passwort ist erforderlich
            </mat-error>
            <mat-error *ngIf="resetForm.get('password')?.hasError('minlength')">
              Passwort muss mindestens 8 Zeichen lang sein
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Passwort bestätigen</mat-label>
            <input matInput type="password" formControlName="password_confirmation" required>
            <mat-icon matSuffix>lock</mat-icon>
            <mat-error *ngIf="resetForm.get('password_confirmation')?.hasError('required')">
              Passwort-Bestätigung ist erforderlich
            </mat-error>
            <mat-error *ngIf="resetForm.get('password_confirmation')?.hasError('passwordMismatch')">
              Passwörter stimmen nicht überein
            </mat-error>
          </mat-form-field>

          <div class="form-actions">
            <button mat-raised-button color="primary" type="submit" [disabled]="!resetForm.valid">
              <mat-icon>check</mat-icon>
              Passwort zurücksetzen
            </button>
          </div>
        </form>
      </div>
    </mat-card-content>
  </mat-card>
</div>